<?xml version="1.0"?>
<robot name="minipock" xmlns:xacro="http://ros.org/wiki/xacro">
  <xacro:macro name="motor"
    params="namespace:=minipock name:=motor_left x:=0.0 y:=0.0 z:=0.0
				       R:=0.0 P:=0.0 Y:=0.0 side:=1 mode:='differential'">

    <link name="${name}_base_link">
      <visual>
        <origin xyz="0 0 0.0" rpy="${pi/2} 0 0" />
        <geometry>
          <mesh filename="package://minipock_description/models/wheel_base.dae" />
        </geometry>
      </visual>
      <inertial>
        <origin xyz="0.0 -0.029 0.0" rpy="0 0 0" />
        <mass value="1.587" />
        <inertia ixx="0.014" ixy="0.0" ixz="0.0" iyy="0.025" iyz="0.0" izz="0.013" />
      </inertial>
    </link>


    <xacro:if value="${mode == 'differential'}">
      <link name="${name}_wheel_link">
        <visual>
          <origin xyz="0 0 -0.024" rpy="${pi/2} 0 0" />
          <geometry>
            <mesh filename="package://minipock_description/models/wheel_rotative.dae" />
          </geometry>
        </visual>
        <collision>
          <origin xyz="0 0.032 0.0" rpy="${pi/2} -0 0" />
          <geometry>
            <cylinder radius="0.036" length="0.006" />
          </geometry>
        </collision>
        <inertial>
          <origin xyz="0.0 -0.029 0.0" rpy="0 -0 0" />
          <mass value="1.587" />
          <inertia ixx="0.014" ixy="0.0" ixz="0.0" iyy="0.025" iyz="0.0" izz="0.013" />
        </inertial>
      </link>
      <joint name="${name}_wheel_joint" type="continuous">
        <parent link="${name}_base_link" />
        <child link="${name}_wheel_link" />
        <origin xyz="0.0 0.0 0.024" rpy="0 0 0" />
        <axis xyz="0 ${side} 0" />
        <limit effort="2000" velocity="45.5" />
      </joint>
    </xacro:if>

    <xacro:if value="${mode == 'holonomic'}">
      <link name="${name}_wheel_link">
        <inertial>
          <origin
            xyz="3.3176058353666561185e-10 1.9488714546560112356e-09 -1.4410385216725714439e-09"
            rpy="0 0 0" />
          <mass value="0.042007231859596941281" />
          <inertia ixx="6.621896807313688522e-06" ixy="-3.30985697672957495e-13"
            ixz="1.2990500681058296834e-10" iyy="1.1099610559885981505e-05"
            iyz="-7.3482336870196013188e-14" izz="6.6214468781051818449e-06" />
        </inertial>
        <visual>
          <origin xyz="0 0 0" rpy="0 -0 0" />
          <geometry>
            <mesh filename="package://minipock_description/models/core.stl" />
          </geometry>
          <material name="${name}_rollers_1_visual_material">
            <color
              rgba="0.91764705882352937127 0.91764705882352937127 0.91764705882352937127 1.0" />
          </material>
        </visual>
      </link>
      <joint name="${name}_wheel_joint" type="continuous">
        <parent link="${name}_base_link" />
        <child link="${name}_wheel_link" />
        <origin xyz="0.0 0.05 0.0" rpy="0 0 0" />
        <axis xyz="0 ${side} 0" />
        <limit effort="2000" velocity="45.5" />
      </joint>

      <link name="${name}_rollers_4">
        <collision>

          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
        </collision>
        <inertial>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <mass value="0.001" />
          <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001" />
        </inertial>
        <visual>
          <origin xyz="0 0.00899999999999999932 0"
            rpy="3.141592653589793116 -0.52359877559829859361 3.141592653589793116" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
          <material name="${name}_rollers_4_visual_material">
            <color
              rgba="0.49803921568627451677 0.49803921568627451677 0.49803921568627451677 1.0" />
          </material>
        </visual>
      </link>
      <joint name="${name}_rollers_4_fixing" type="continuous">
        <origin xyz="0 0 0" rpy="0 -0 0" />
        <parent link="${name}_wheel_link" />
        <child link="${name}_rollers_4" />
        <axis xyz="0 0 1" />
        <limit effort="1" velocity="20" />

      </joint>

      <link name="${name}_rollers_5">
        <collision>
          <origin xyz="0 0.00899999999999999932 0" rpy="-0 -1.570796326794896558 0" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
        </collision>
        <inertial>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <mass value="0.001" />
          <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001" />
        </inertial>
        <visual>
          <origin xyz="0 0.00899999999999999932 0" rpy="-0 -1.570796326794896558 0" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
          <material name="${name}_rollers_5_visual_material">
            <color
              rgba="0.49803921568627451677 0.49803921568627451677 0.49803921568627451677 1.0" />
          </material>
        </visual>
      </link>
      <joint name="${name}_rollers_5_fixing" type="continuous">
        <origin xyz="0 0 0" rpy="0 -0 0" />
        <parent link="${name}_wheel_link" />
        <child link="${name}_rollers_5" />
        <axis xyz="0 0 1" />
        <limit effort="1" velocity="20" />

      </joint>

      <link name="${name}_rollers_6">
        <collision>
          <origin xyz="0 0.00899999999999999932 0" rpy="-0 1.570796326794896558 0" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
        </collision>
        <inertial>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <mass value="0.001" />
          <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001" />
        </inertial>
        <visual>
          <origin xyz="0 0.00899999999999999932 0" rpy="-0 1.570796326794896558 0" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
          <material name="${name}_rollers_6_visual_material">
            <color
              rgba="0.49803921568627451677 0.49803921568627451677 0.49803921568627451677 1.0" />
          </material>
        </visual>
      </link>
      <joint name="${name}_rollers_6_fixing" type="continuous">
        <origin xyz="0 0 0" rpy="0 -0 0" />
        <parent link="${name}_wheel_link" />
        <child link="${name}_rollers_6" />
        <axis xyz="0 0 1" />
        <limit effort="1" velocity="20" />

      </joint>

      <link name="${name}_rollers_7">
        <collision>
          <origin xyz="0 0.00899999999999999932 0" rpy="0 0.52359877559829870464 0" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
        </collision>
        <inertial>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <mass value="0.001" />
          <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001" />
        </inertial>
        <visual>
          <origin xyz="0 0.00899999999999999932 0" rpy="0 0.52359877559829870464 0" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
          <material name="${name}_rollers_7_visual_material">
            <color
              rgba="0.49803921568627451677 0.49803921568627451677 0.49803921568627451677 1.0" />
          </material>
        </visual>
      </link>
      <joint name="${name}_rollers_7_fixing" type="continuous">
        <origin xyz="0 0 0" rpy="0 -0 0" />
        <parent link="${name}_wheel_link" />
        <child link="${name}_rollers_7" />
        <axis xyz="0 0 1" />
        <limit effort="1" velocity="20" />

      </joint>

      <link name="${name}_rollers_8">
        <collision>
          <origin xyz="0 0.00899999999999999932 0" rpy="0 -0.52359877559829914873 0" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
        </collision>
        <inertial>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <mass value="0.001" />
          <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001" />
        </inertial>
        <visual>
          <origin xyz="0 0.00899999999999999932 0" rpy="0 -0.52359877559829914873 0" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
          <material name="${name}_rollers_8_visual_material">
            <color
              rgba="0.49803921568627451677 0.49803921568627451677 0.49803921568627451677 1.0" />
          </material>
        </visual>
      </link>
      <joint name="${name}_rollers_8_fixing" type="continuous">
        <origin xyz="0 0 0" rpy="0 -0 0" />
        <parent link="${name}_wheel_link" />
        <child link="${name}_rollers_8" />
        <axis xyz="0 0 1" />
        <limit effort="1" velocity="20" />

      </joint>

      <link name="${name}_rollers_9">
        <collision>
          <origin xyz="0 0.00899999999999999932 0"
            rpy="3.141592653589793116 0.52359877559829914873 3.141592653589793116" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
        </collision>
        <inertial>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <mass value="0.001" />
          <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001" />
        </inertial>
        <visual>
          <origin xyz="0 0.00899999999999999932 0"
            rpy="3.141592653589793116 0.52359877559829914873 3.141592653589793116" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
          <material name="${name}_rollers_9_visual_material">
            <color
              rgba="0.49803921568627451677 0.49803921568627451677 0.49803921568627451677 1.0" />
          </material>
        </visual>
      </link>
      <joint name="${name}_rollers_9_fixing" type="continuous">
        <origin xyz="0 0 0" rpy="0 -0 0" />
        <parent link="${name}_wheel_link" />
        <child link="${name}_rollers_9" />
        <axis xyz="0 0 1" />
        <limit effort="1" velocity="20" />

      </joint>

      <link name="${name}_rollers_10">
        <collision>
          <origin
            xyz="2.500000000003367584e-06 -2.7755575615628913511e-17 4.3301270189720353354e-06"
            rpy="-8.3452360045596450484e-16 -1.0471975511965962991 9.6362485073669450166e-16" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
        </collision>
        <inertial>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <mass value="0.001" />
          <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001" />
        </inertial>
        <visual>
          <origin
            xyz="2.500000000003367584e-06 -2.7755575615628913511e-17 4.3301270189720353354e-06"
            rpy="-8.3452360045596450484e-16 -1.0471975511965962991 9.6362485073669450166e-16" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
          <material name="${name}_rollers_10_visual_material">
            <color
              rgba="0.49803921568627451677 0.49803921568627451677 0.49803921568627451677 1.0" />
          </material>
        </visual>
      </link>
      <joint name="${name}_rollers_10_fixing" type="continuous">
        <origin xyz="0 0 0" rpy="0 -0 0" />
        <parent link="${name}_wheel_link" />
        <child link="${name}_rollers_10" />
        <axis xyz="0 0 1" />
        <limit effort="1" velocity="20" />

      </joint>

      <link name="${name}_rollers_11">
        <collision>
          <origin
            xyz="-2.5000000000650840986e-06 -1.1265347830754021332e-17 -4.3301270189615499146e-06"
            rpy="-3.141592653589793116 1.0471975511965965211 3.1415926535897922278" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
        </collision>
        <inertial>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <mass value="0.001" />
          <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001" />
        </inertial>
        <visual>
          <origin
            xyz="-2.5000000000650840986e-06 -1.1265347830754021332e-17 -4.3301270189615499146e-06"
            rpy="-3.141592653589793116 1.0471975511965965211 3.1415926535897922278" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
          <material name="${name}_rollers_11_visual_material">
            <color
              rgba="0.49803921568627451677 0.49803921568627451677 0.49803921568627451677 1.0" />
          </material>
        </visual>
      </link>
      <joint name="${name}_rollers_11_fixing" type="continuous">
        <origin xyz="0 0 0" rpy="0 -0 0" />
        <parent link="${name}_wheel_link" />
        <child link="${name}_rollers_11" />
        <axis xyz="0 0 1" />
        <limit effort="1" velocity="20" />

      </joint>

      <link name="${name}_rollers_12">
        <collision>
          <origin
            xyz="4.9999999999113253768e-06 -2.7755575615628913511e-17 6.9388939039072283776e-18"
            rpy="1.8722173686805076642e-30 4.3675930115564019462e-15 4.8181242536834853273e-16" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
        </collision>
        <inertial>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <mass value="0.001" />
          <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001" />
        </inertial>
        <visual>
          <origin
            xyz="4.9999999999113253768e-06 -2.7755575615628913511e-17 6.9388939039072283776e-18"
            rpy="1.8722173686805076642e-30 4.3675930115564019462e-15 4.8181242536834853273e-16" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
          <material name="${name}_rollers_12_visual_material">
            <color
              rgba="0.49803921568627451677 0.49803921568627451677 0.49803921568627451677 1.0" />
          </material>
        </visual>
      </link>
      <joint name="${name}_rollers_12_fixing" type="continuous">
        <origin xyz="0 0 0" rpy="0 -0 0" />
        <parent link="${name}_wheel_link" />
        <child link="${name}_rollers_12" />
        <axis xyz="0 0 1" />
        <limit effort="1" velocity="20" />

      </joint>

      <link name="${name}_rollers_13">
        <collision>
          <origin
            xyz="-2.5000000000402304579e-06 -2.6888213877640509963e-17 4.3301270189815763145e-06"
            rpy="-3.1415926535897922278 -1.0471975511965989636 3.1415926535897922278" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
        </collision>
        <inertial>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <mass value="0.001" />
          <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001" />
        </inertial>
        <visual>
          <origin
            xyz="-2.5000000000402304579e-06 -2.6888213877640509963e-17 4.3301270189815763145e-06"
            rpy="-3.1415926535897922278 -1.0471975511965989636 3.1415926535897922278" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
          <material name="${name}_rollers_13_visual_material">
            <color
              rgba="0.49803921568627451677 0.49803921568627451677 0.49803921568627451677 1.0" />
          </material>
        </visual>
      </link>
      <joint name="${name}_rollers_13_fixing" type="continuous">
        <origin xyz="0 0 0" rpy="0 -0 0" />
        <parent link="${name}_wheel_link" />
        <child link="${name}_rollers_13" />
        <axis xyz="0 0 1" />
        <limit effort="1" velocity="20" />

      </joint>

      <link name="${name}_rollers_14">
        <collision>
          <origin
            xyz="-4.9999999999078559298e-06 -2.7755575615628913511e-17 3.8163916471489756077e-17"
            rpy="-3.141592653589793116 -4.3675930115564019462e-15 3.1415926535897926719" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
        </collision>
        <inertial>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <mass value="0.001" />
          <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001" />
        </inertial>
        <visual>
          <origin
            xyz="-4.9999999999078559298e-06 -2.7755575615628913511e-17 3.8163916471489756077e-17"
            rpy="-3.141592653589793116 -4.3675930115564019462e-15 3.1415926535897926719" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
          <material name="${name}_rollers_14_visual_material">
            <color
              rgba="0.49803921568627451677 0.49803921568627451677 0.49803921568627451677 1.0" />
          </material>
        </visual>
      </link>
      <joint name="${name}_rollers_14_fixing" type="continuous">
        <origin xyz="0 0 0" rpy="0 -0 0" />
        <parent link="${name}_wheel_link" />
        <child link="${name}_rollers_14" />
        <axis xyz="0 0 1" />
        <limit effort="1" velocity="20" />

      </joint>

      <link name="${name}_rollers_15">
        <collision>
          <origin
            xyz="2.5000000000471693518e-06 -2.6888213877640506882e-17 -4.330127018950351292e-06"
            rpy="8.3452360045596864635e-16 1.0471975511965989636 9.6362485073669943204e-16" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
        </collision>
        <inertial>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <mass value="0.001" />
          <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001" />
        </inertial>
        <visual>
          <origin
            xyz="2.5000000000471693518e-06 -2.6888213877640506882e-17 -4.330127018950351292e-06"
            rpy="8.3452360045596864635e-16 1.0471975511965989636 9.6362485073669943204e-16" />
          <geometry>
            <mesh filename="package://minipock_description/models/tire.stl" />
          </geometry>
          <material name="${name}_rollers_15_visual_material">
            <color
              rgba="0.49803921568627451677 0.49803921568627451677 0.49803921568627451677 1.0" />
          </material>
        </visual>
      </link>
      <joint name="${name}_rollers_15_fixing" type="continuous">
        <origin xyz="0 0 0" rpy="0 -0 0" />
        <parent link="${name}_wheel_link" />
        <child link="${name}_rollers_15" />
        <axis xyz="0 0 1" />
        <limit effort="1" velocity="20" />

      </joint>
    </xacro:if>


    <joint name="${name}_joint" type="fixed">
      <parent link="${namespace}base_link" />
      <child link="${name}_base_link" />
      <origin xyz="${x} ${y} ${z}" rpy="${R} ${P} ${Y}" />
    </joint>


    <gazebo>
      <plugin filename="gz-sim-joint-controller-system"
        name="gz::sim::systems::JointController">
        <joint_name>${name}_wheel_joint</joint_name>
        <use_velocity_commands>true</use_velocity_commands>
        <topic>${namespace}${name}/pos</topic>
        <name>${name}</name>
      </plugin>
    </gazebo>
  </xacro:macro>
</robot>